<!-- Password Change Component -->
<div class="card bg-base-100 shadow-xl">
  <div class="card-body">
    <h2 class="card-title">Change Password</h2>
    <p class="text-base-content/70 mb-4">Update your password to keep your account secure.</p>
    
    <form id="changePasswordForm" class="space-y-4">
      <!-- Error/Success Messages -->
      <div id="passwordMessageContainer" class="hidden"></div>
      
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text">Current Password</span>
        </div>
        <input type="password" class="input input-bordered w-full" 
               placeholder="Enter current password" name="current_password" required />
      </label>
      
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text">New Password</span>
        </div>
        <input type="password" class="input input-bordered w-full" 
               placeholder="Enter new password (min 8 characters)" name="new_password" 
               required minlength="8" />
      </label>
      
      <label class="form-control w-full">
        <div class="label">
          <span class="label-text">Confirm New Password</span>
        </div>
        <input type="password" class="input input-bordered w-full" 
               placeholder="Confirm new password" name="confirm_new_password" required />
      </label>
      
      <!-- Password Requirements -->
      <div class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <h4 class="font-bold">Password Requirements:</h4>
          <ul class="list-disc list-inside space-y-1 text-sm">
            <li>At least 8 characters long</li>
            <li>Mix of letters and numbers recommended</li>
            <li>Avoid using personal information</li>
          </ul>
        </div>
      </div>
      
      <div class="card-actions">
        <button type="submit" class="btn btn-primary">
          <span class="loading loading-spinner loading-sm hidden" id="passwordSpinner"></span>
          <span id="passwordButtonText">Change Password</span>
        </button>
      </div>
    </form>
  </div>
</div>

<script>
document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const form = e.target;
  const formData = new FormData(form);
  const button = document.getElementById('passwordButtonText');
  const spinner = document.getElementById('passwordSpinner');
  const messageContainer = document.getElementById('passwordMessageContainer');
  
  // Validate password confirmation
  const newPassword = formData.get('new_password');
  const confirmPassword = formData.get('confirm_new_password');
  
  if (newPassword !== confirmPassword) {
    showPasswordMessage('New passwords do not match', 'error');
    return;
  }
  
  // Show loading state
  button.textContent = 'Changing Password...';
  spinner.classList.remove('hidden');
  form.querySelector('button[type="submit"]').disabled = true;
  
  try {
    const response = await fetch('/api/v1/change-password', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        current_password: formData.get('current_password'),
        new_password: formData.get('new_password')
      }),
      credentials: 'include'
    });
    
    const data = await response.json();
    
    if (data.success) {
      showPasswordMessage('Password changed successfully!', 'success');
      form.reset(); // Clear the form
    } else {
      showPasswordMessage(data.error?.message || 'Failed to change password', 'error');
    }
  } catch (error) {
    console.error('Password change error:', error);
    showPasswordMessage('An error occurred while changing password', 'error');
  } finally {
    // Reset button state
    button.textContent = 'Change Password';
    spinner.classList.add('hidden');
    form.querySelector('button[type="submit"]').disabled = false;
  }
});

function showPasswordMessage(message, type) {
  const container = document.getElementById('passwordMessageContainer');
  const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
  
  container.innerHTML = `
    <div class="alert ${alertClass}">
      <span>${message}</span>
    </div>
  `;
  container.classList.remove('hidden');
  
  // Auto-hide success messages
  if (type === 'success') {
    setTimeout(() => {
      container.classList.add('hidden');
    }, 5000);
  }
}
</script>
